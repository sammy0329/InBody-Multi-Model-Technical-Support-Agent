# 기능 명세서: InBody Tech-Master (Multi-Model Edition)

**Feature Branch**: `001-inbody-tech-master`
**Created**: 2026-01-30
**Status**: Draft
**Input**: 사용자의 InBody 기종을 식별하여 맞춤형 기술 지원 및 임상 가이드를 제공하는 AI 에이전트 구축

## 사용자 시나리오 및 테스트 *(필수)*

### User Story 1 - 기종 식별 및 라우팅 (Priority: P1)

사용자가 대화를 시작하면, 시스템은 사용자의 InBody 기종(270S, 580, 770S, 970S)을 식별하고, 해당 기종 전용 지원 흐름으로 자동 분기한다. 기종 식별은 텍스트 대화(모델명 직접 입력) 또는 기기 사진(이미지 인식)을 통해 이루어진다.

**우선순위 근거**: 기종 식별은 모든 후속 에이전트(설치, 연동, 트러블슈팅, 임상 방어)의 전제 조건이다. 기종이 식별되지 않으면 어떤 기술 지원도 제공할 수 없으므로 최우선 순위이다.

**독립 테스트**: 기종 식별 단독으로 테스트 가능 — 사용자가 모델명을 입력하거나 기기 사진을 전송했을 때, 시스템이 올바른 기종을 식별하고 해당 기종 전용 환영 메시지를 표시하는지 확인한다.

**인수 시나리오**:

1. **Given** 사용자가 대화를 시작하고 "InBody 770S" 또는 "770S"를 입력한 상태, **When** 시스템이 입력을 분석하면, **Then** 770S 전문가용 모드로 분기하고, 전문적 톤앤매너로 환영 메시지를 표시한다.
2. **Given** 사용자가 InBody 기기 사진을 업로드한 상태, **When** 시스템이 이미지를 분석하면, **Then** 기기 외관/디스플레이에서 기종을 식별하고 확인 메시지를 표시한다.
3. **Given** 사용자가 기종을 명시하지 않고 "체성분 분석기 문제가 있어요"라고 입력한 상태, **When** 시스템이 기종 정보가 없음을 감지하면, **Then** 기종 확인 질문(선택지 또는 사진 업로드 안내)을 표시한다.
4. **Given** 사용자가 지원하지 않는 기종(예: "InBody 120")을 입력한 상태, **When** 시스템이 지원 범위 밖임을 감지하면, **Then** 지원 불가 안내와 함께 InBody 공식 고객센터 연락처를 제공한다.

---

### User Story 2 - 트러블슈팅 에이전트 (Priority: P2)

기종이 식별된 사용자가 에러 코드나 기기 이상 증상을 보고하면, 트러블슈팅 에이전트가 해당 기종의 에러 코드 DB와 매뉴얼을 참조하여 원인을 분석하고, 단계별 해결책을 제시한다. 이때 사용자 해결 가능 범위(Level 1)와 서비스 센터 이관(Level 3)을 엄격히 구분한다.

**우선순위 근거**: 트러블슈팅은 기술 지원 문의의 가장 빈번한 유형이다. 에러 코드 해결은 사용자 만족도와 장비 가동률에 직접적 영향을 미친다.

**독립 테스트**: 기종이 식별된 상태에서, 에러 코드를 입력했을 때 해당 기종 전용 해결 가이드가 정확히 제시되는지 확인한다.

**인수 시나리오**:

1. **Given** 270S 사용자가 "에러코드 E003이 떠요"라고 입력한 상태, **When** 트러블슈팅 에이전트가 270S 에러 코드 DB를 검색하면, **Then** E003의 원인과 Level 1 해결 단계를 쉬운 말투로 안내한다.
2. **Given** 970S 사용자가 센서 관련 에러를 보고한 상태, **When** 에이전트가 해당 에러가 Level 3(하드웨어 수리)에 해당한다고 판단하면, **Then** 사용자에게 서비스 센터 이관을 안내하고, 직접 수리를 시도하지 말 것을 경고한다.
3. **Given** 사용자가 에러 코드 없이 "측정이 안 돼요"라는 증상만 보고한 상태, **When** 에이전트가 증상 기반 진단을 수행하면, **Then** 가능한 원인 목록과 각 원인에 대한 확인 절차를 단계별로 안내한다.
4. **Given** 580 사용자에게 Level 1 해결책을 안내한 후, **When** 사용자가 "해결되지 않았어요"라고 응답하면, **Then** 다음 단계의 해결책을 제시하거나, 더 이상의 사용자 해결이 불가능하면 서비스 센터 이관을 안내한다.

---

### User Story 3 - 설치 도우미 에이전트 (Priority: P3)

기종이 식별된 사용자가 기기 설치(개봉, 조립, 전원 연결, 초기 세팅)에 대한 도움을 요청하면, 설치 도우미 에이전트가 해당 기종의 설치 유형(접이식 vs 분리형)에 맞는 단계별 안내를 제공한다.

**우선순위 근거**: 설치는 기기 수명 주기 초반에 한 번 발생하지만, 잘못된 설치는 이후 모든 측정 신뢰성에 영향을 미치므로 중요하다.

**독립 테스트**: 기종이 식별된 상태에서, "설치 방법"을 문의했을 때 해당 기종의 조립 유형에 맞는 설치 가이드가 정확히 제시되는지 확인한다.

**인수 시나리오**:

1. **Given** 270S 사용자(접이식)가 "처음 설치하려고 하는데 어떻게 하나요?"라고 입력한 상태, **When** 설치 도우미가 270S 매뉴얼을 참조하면, **Then** 접이식 기기의 개봉 → 펼침 → 전원 연결 → 초기 세팅 순서를 단계별로 안내한다.
2. **Given** 770S 사용자(분리형)가 설치를 문의한 상태, **When** 설치 도우미가 770S 매뉴얼을 참조하면, **Then** 분리형 기기의 본체 조립 → 전극 연결 → 전원 → 캘리브레이션 순서를 전문적 톤으로 안내한다.
3. **Given** 사용자가 설치 중 특정 단계에서 막힌 상태, **When** "전원이 안 켜져요"라고 입력하면, **Then** 해당 단계의 체크리스트(전원 케이블 연결 확인, 콘센트 확인 등)를 제시한다.

---

### User Story 4 - 연동 에이전트 (Priority: P4)

기종이 식별된 사용자가 프린터, PC 소프트웨어, 바코드 리더기 등 주변기기 연결에 대한 도움을 요청하면, 연동 에이전트가 해당 기종의 호환표를 참조하여 호환 여부를 확인하고, 연결 절차를 안내한다.

**우선순위 근거**: 주변기기 연동은 기기 설치 이후 업무 환경 구성에 필수적이지만, 설치와 트러블슈팅보다는 빈도가 낮다.

**독립 테스트**: 기종이 식별된 상태에서, 주변기기 연결 문의 시 해당 기종의 호환표를 기반으로 정확한 호환 여부와 연결 방법을 안내하는지 확인한다.

**인수 시나리오**:

1. **Given** 580 사용자가 "프린터를 연결하고 싶어요"라고 입력한 상태, **When** 연동 에이전트가 580 호환표를 조회하면, **Then** 호환되는 프린터 목록과 연결 방법을 쉬운 말투로 안내한다.
2. **Given** 770S 사용자가 특정 PC 소프트웨어 연동을 문의한 상태, **When** 에이전트가 호환성을 확인하면, **Then** 호환 여부, 필요한 드라이버/소프트웨어 버전, 설정 절차를 전문적으로 안내한다.
3. **Given** 사용자가 호환되지 않는 주변기기를 연결하려는 상태, **When** 에이전트가 비호환을 감지하면, **Then** 비호환 사유를 설명하고 대안 주변기기를 추천한다.

---

### User Story 5 - 임상 방어 에이전트 (Priority: P5)

기종이 식별된 사용자(주로 770S/970S 전문가용)가 측정 결과의 신뢰성에 의문을 제기하면, 임상 방어 에이전트가 측정 결과에 영향을 줄 수 있는 생리학적 변수(운동, 식사, 수분 섭취, 체위 등)를 설명하고, 결과의 신뢰성을 방어한다. 모든 임상 관련 응답에는 의학적 면책 문구를 포함한다.

**우선순위 근거**: 임상 방어는 전문가용 기종 사용자에게 핵심적인 가치를 제공하지만, 나머지 4개 에이전트가 정상 동작하는 상태에서만 의미가 있다.

**독립 테스트**: 기종이 식별된 상태에서, 측정 결과 신뢰성 관련 질문을 입력했을 때, 해당 기종의 측정 항목에 맞는 생리학적 설명과 면책 문구가 포함된 응답이 제공되는지 확인한다.

**인수 시나리오**:

1. **Given** 970S 사용자가 "환자의 체수분량이 어제와 오늘 크게 달라졌는데 기계가 정확한 건가요?"라고 질문한 상태, **When** 임상 방어 에이전트가 활성화되면, **Then** 체수분량에 영향을 미치는 생리학적 변수(식전/식후, 운동, 체위 등)를 전문적 톤으로 설명하고, 응답 끝에 의학적 면책 문구를 표시한다.
2. **Given** 270S 사용자가 "체지방률이 갑자기 많이 변했어요"라고 질문한 상태, **When** 임상 방어 에이전트가 활성화되면, **Then** 일상적 변수(식사, 운동, 수분 섭취)를 쉬운 말투로 설명하고, 면책 문구를 포함한다.
3. **Given** 사용자가 측정 결과를 토대로 특정 질환에 대해 질문한 상태, **When** 에이전트가 의학적 진단 요청임을 감지하면, **Then** 의학적 진단이 불가함을 명확히 안내하고, 전문 의료인 상담을 권고한다.

---

### 엣지 케이스

- 사용자가 대화 중간에 기종을 변경하는 경우(예: "아, 770S가 아니라 580이었어요"), 시스템은 기종을 재식별하고 이전 대화 맥락에서 잘못된 기종 정보를 폐기해야 한다.
- 사용자가 동시에 여러 기종에 대해 질문하는 경우(예: "270S와 580 차이가 뭐예요?"), 시스템은 비교 질문임을 인식하되 각 기종의 정보를 엄격히 분리하여 응답한다.
- 네트워크 장애로 RAG 검색이 실패하는 경우, 시스템은 "현재 정보 검색에 문제가 있습니다"라는 안내와 함께 재시도를 제안한다.
- 사용자가 한 세션에서 여러 에이전트 기능을 번갈아 사용하는 경우(예: 트러블슈팅 → 연동 → 다시 트러블슈팅), 기종 식별 정보는 유지되어야 한다.
- 이미지 인식으로 기종을 식별할 때, 사진 품질이 낮거나 기기가 부분적으로만 보이는 경우 확인 질문을 한다.

## 요구사항 *(필수)*

### 기능 요구사항

- **FR-001**: 시스템은 반드시 사용자의 텍스트 입력에서 InBody 기종(270S, 580, 770S, 970S)을 식별할 수 있어야 한다.
- **FR-002**: 시스템은 반드시 사용자가 업로드한 기기 이미지에서 InBody 기종을 식별할 수 있어야 한다.
- **FR-003**: 시스템은 기종이 식별되지 않은 상태에서 어떠한 기술 지원 응답도 생성하지 않아야 하며, 기종 확인 절차를 먼저 수행해야 한다.
- **FR-004**: 시스템은 식별된 기종에 따라 4개 전문 에이전트(설치, 연동, 트러블슈팅, 임상 방어) 중 적절한 에이전트로 라우팅해야 한다.
- **FR-005**: 트러블슈팅 에이전트는 반드시 해당 기종 전용 에러 코드 DB를 참조하여 원인과 해결책을 제시해야 한다.
- **FR-006**: 트러블슈팅 에이전트는 반드시 모든 해결책을 Level 1(사용자 해결)과 Level 3(서비스 센터 이관)으로 구분하여 안내해야 한다.
- **FR-007**: 설치 도우미 에이전트는 반드시 해당 기종의 설치 유형(접이식/분리형)에 맞는 단계별 가이드를 제공해야 한다.
- **FR-008**: 연동 에이전트는 반드시 해당 기종의 주변기기 호환표를 참조하여 호환 여부를 확인하고 연결 절차를 안내해야 한다.
- **FR-009**: 임상 방어 에이전트는 반드시 모든 응답에 의학적 면책 문구("이 정보는 의학적 진단이 아니며, 전문 의료인의 상담을 대체하지 않습니다.")를 포함해야 한다.
- **FR-010**: 시스템은 반드시 기종에 따른 톤앤매너를 적용해야 한다 — 보급형(270S/580)은 쉽고 실용적, 전문가용(770S/970S)은 전문적 근거 중심.
- **FR-011**: 시스템은 반드시 PDF 매뉴얼과 구조화된 DB(에러코드, 호환표)를 RAG 방식으로 참조하여 응답을 생성해야 한다.
- **FR-012**: RAG 검색 시 반드시 식별된 기종의 메타데이터 필터를 적용하여, 다른 기종의 정보가 응답에 포함되지 않도록 해야 한다.
- **FR-013**: 시스템은 반드시 사용자가 대화 중 기종을 정정할 경우, 기종을 재식별하고 이전 잘못된 기종 정보 기반 응답을 폐기해야 한다.
- **FR-014**: 시스템은 지원하지 않는 기종에 대한 질문을 받을 경우, 지원 불가 안내와 InBody 공식 고객센터 연락처를 제공해야 한다.

### 핵심 엔티티

- **기종(Model)**: InBody 기기의 모델을 나타냄 (270S, 580, 770S, 970S). 분류(보급형/전문가용), 설치 유형(접이식/분리형), 측정 항목 목록, 톤앤매너 프로필과 연관된다.
- **에러 코드(Error Code)**: 기종별로 고유한 에러 코드. 코드, 원인 설명, 해결 단계, 지원 수준(Level 1/Level 3)을 포함한다.
- **주변기기 호환표(Peripheral Compatibility)**: 기종별 호환 가능한 주변기기(프린터, PC, 바코드 리더기 등) 목록과 연결 방법.
- **매뉴얼 문서(Manual Document)**: 기종별 PDF 매뉴얼. RAG 검색의 원본 자료이며, 기종 메타데이터로 태깅된다.
- **생리학적 변수(Physiological Variable)**: 측정 결과에 영향을 미치는 요인(운동, 식사, 수분, 체위 등). 기종별 측정 항목에 따라 관련 변수가 다를 수 있다.
- **지원 수준(Support Level)**: 기술 지원 조치의 분류. Level 1(사용자 해결)과 Level 3(서비스 센터 이관)으로 구분된다.

## 성공 기준 *(필수)*

### 측정 가능한 결과

- **SC-001**: 시스템의 텍스트 기반 기종 식별 정확도가 95% 이상이어야 한다.
- **SC-002**: 시스템의 이미지 기반 기종 식별 정확도가 85% 이상이어야 한다.
- **SC-003**: 트러블슈팅 에이전트가 알려진 에러 코드에 대해 올바른 해결책을 제시하는 비율이 90% 이상이어야 한다.
- **SC-004**: 모든 임상 관련 응답의 100%에 의학적 면책 문구가 포함되어야 한다.
- **SC-005**: 기종 간 정보 오염(다른 기종의 정보가 응답에 포함되는 경우) 발생률이 0%이어야 한다.
- **SC-006**: Level 3 조치에 해당하는 문제에 대해 사용자 직접 수리를 안내하는 비율이 0%이어야 한다.
- **SC-007**: 사용자 만족도 조사에서 "문제 해결에 도움이 되었다"는 응답이 80% 이상이어야 한다.
- **SC-008**: 보급형 기종(270S/580) 사용자의 응답 이해도("쉽게 이해할 수 있었다") 비율이 85% 이상이어야 한다.

## 가정 사항

- 각 기종(270S, 580, 770S, 970S)의 PDF 매뉴얼이 사전에 확보되어 있다고 가정한다.
- 기종별 에러 코드 목록과 호환 주변기기 목록이 구조화된 형태로 제공된다고 가정한다.
- 사용자는 한국어로 질문한다고 가정한다.
- 이미지 기반 기종 식별을 위한 학습 데이터(기종별 기기 사진)가 확보 가능하다고 가정한다.
- 한 세션에서 사용자는 하나의 기종에 대해서만 지원을 요청하는 것이 일반적인 패턴이라고 가정한다.
